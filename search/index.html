---
permalink: /search/
layout: page
title: Search
---


<script>
  (() => {
    //////////////////////////////////
    // Rendering

    const renderResults = (results) => {
      const element = document.getElementById('search-results');

      if (!results.length) {
        element.innerHTML = renderResults_noResults();
      }
      else {
        element.innerHTML = `
          <ol>
            ${results.map(renderResults_result).join('')}
          </ol>
        `;
      }
    };

    const renderResults_noResults = () => {
      return `<h4 class="title">No results found</h4>`;
    };

    const renderResults_result = (result) => {
      return `
        <li>
          <a href="${result.url}">
            <h2 class="title">${highlight(result.title)}</h2>
            <p>${highlight(result.description)}... <span class="read-more">Continue reading</span></p>
          </a>
        </li>
      `;
    };

    const highlight = (text) => {
      return text.replace(/\uE000/g, '<span class="bg-yellow">').replace(/\uE001/g, '</span>');
    };

    //////////////////////////////////
    // Translation

    const translate_fromSearchGov = (response) => {
      return response.web.results.map(result => {
        return {
          url: result.url,
          title: result.title,
          description: result.snippet
        };
      });
    };

    //////////////////////////////////
    // Performing search

    const searchEndpoint = new URL('{{site.searchgov.endpoint}}/api/v2/search/i14y');

    Object.entries({
      affiliate: '{{site.searchgov.affiliate}}',
      access_key: '{{site.searchgov.access_key}}',
      query: new URLSearchParams(window.location.search).get('query'),
      limit: 50
    }).forEach(([key, value]) => searchEndpoint.searchParams.append(key, value));

    const searchgov = fetch(searchEndpoint)
      .then(response => response.json());

    searchgov.catch(error => {
      console.error('Request for json from search.gov failed', error);
      // Start fallback here, if implemented
      // If timeout is needed, wrap in a promise which rejects after a setTimeout interval.
    });

    searchgov.then(results => renderResults(translate_fromSearchGov(results)));
  })();
</script>

{% if site.searchgov %}
<h1>Search Results</h1>
<div id="search-results"></div>
{% else %}
<script>
  window.location = "/";
</script>
{% endif %}
